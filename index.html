<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<title>Гостей всего</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style>
			html,
			body {
				margin: 0;
				height: 100%;
				background: #1c1c1c;
				color: #f5f5f5;
				font-family: -apple-system, system-ui, "SF Pro Display", Segoe UI,
					Roboto, Arial, sans-serif;
			}
			* {
				box-sizing: border-box;
			}

			/* верхняя панель */
			.bar {
				display: flex;
				gap: 12px;
				align-items: center;
				justify-content: center;
				padding: 16px;
				border-bottom: 1px solid #333;
				background: #1f1f1f;
				position: sticky;
				top: 0;
			}
			.bar label {
				font-size: 15px;
				color: #aaa;
			}
			.bar input[type="date"] {
				font: inherit;
				font-size: 16px;
				color: #f5f5f5;
				background: #2a2a2a;
				border: 1px solid #444;
				border-radius: 8px;
				padding: 6px 10px;
			}

			/* цифра */
			.stage {
				display: flex;
				align-items: center;
				justify-content: center;
				height: calc(100% - 64px);
				padding: 20px;
			}
			.value {
				font-weight: 800;
				line-height: 1;
				letter-spacing: 2px;
				text-align: center;
				font-variant-numeric: tabular-nums lining-nums;
				font-size: clamp(120px, 35vw, 540px);
				user-select: none;
			}

			@media (max-width: 800px) {
				.bar label {
					font-size: 14px;
				}
				.value {
					font-size: 42vw;
				}
			}
		</style>
	</head>
	<body>
		<div class="bar">
			<label for="date">Дата</label>
			<input id="date" type="date" />
		</div>
		<div class="stage">
			<div id="num" class="value">—</div>
		</div>
		<script>
			const API = "/api/guests"
			const REFRESH_MS = 30 * 1000
			const numEl = document.getElementById("num")
			const dateEl = document.getElementById("date")

			function todayISO() {
				const d = new Date()
				const tz = d.getTimezoneOffset()
				const local = new Date(d.getTime() - tz * 60000)
				return local.toISOString().slice(0, 10)
			}

			async function load() {
				const d = dateEl.value
				const url = d ? `${API}?date=${d}` : API
				try {
					const r = await fetch(url, { cache: "no-store" })
					const j = await r.json().catch(() => ({}))
					if (r.ok && typeof j.value === "number") {
						numEl.textContent = j.value
					} else {
						numEl.textContent = "—"
					}
				} catch (e) {
					numEl.textContent = "—"
				}
			}

			dateEl.value = todayISO()
			dateEl.addEventListener("change", load)

			load()
			setInterval(load, REFRESH_MS)
			document.addEventListener("visibilitychange", () => {
				if (!document.hidden) load()
			})
		</script>
	</body>
</html>
